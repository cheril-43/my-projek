<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Web Pribadi ‚Äî Feed & Login</title>
  <meta name="description" content="Web pribadi punya Reisya!." />
  <meta property="og:title" content="Web Pribadi" />
  <meta property="og:description" content="ini web pribadi untuk tugas praktikum IT." />
  <meta name="theme-color" content="#071025" />
  <style>
    :root{
      --accent:#7c5cff;
      --accent-2:#5ad0ff;
      --bg:#0f1720;
      --card:#0b1220;
      --muted:#9aa6b2;
      --text:#e6eef6;
      --glass: rgba(255,255,255,.03);
    }
    [data-theme="light"]{
      --accent:#6a4cff;
      --accent-2:#2b98ff;
      --bg:#f6f8fb;
      --card:#ffffff;
      --muted:#66707a;
      --text:#091014;
      --glass: rgba(0,0,0,.04);
    }

    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0; background:linear-gradient(180deg,#071025 0%, #061020 100%); color:var(--text); min-height:100vh; transition:background .25s,color .25s}
    [data-theme="light"] body{background:linear-gradient(180deg,#f6f8fb 0%, #eef3fa 100%)}
    .container{max-width:980px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;gap:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#052;box-shadow:0 6px 18px rgba(124,92,255,.18)}
    h1{font-size:18px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px;align-items:center}

    main{display:grid;grid-template-columns:320px 1fr;gap:18px}

    /* Card */
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));padding:14px;border-radius:12px;box-shadow:0 6px 22px rgba(2,6,23,.6);transition:transform .18s,box-shadow .18s}
    [data-theme="light"] .card{background:var(--card);box-shadow:0 6px 14px rgba(2,6,23,.06)}
    .card:hover{transform:translateY(-4px)}

    /* Auth */
    .auth .field{margin-bottom:10px;position:relative}
    input[type=text], input[type=password], input[type=file], textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.04);background:transparent;color:inherit}
    [data-theme="light"] input[type=text], [data-theme="light"] input[type=password]{border:1px solid rgba(0,0,0,.06);background:transparent}
    button{background:var(--accent);border:none;padding:10px 12px;border-radius:9px;color:#051;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,.06);color:var(--muted)}
    .muted{color:var(--muted);font-size:13px}

    .profile{display:flex;align-items:center;gap:12px}
    .avatar{width:56px;height:56px;border-radius:10px;background:var(--glass);display:flex;align-items:center;justify-content:center;font-weight:700;overflow:hidden}
    .avatar img{width:100%;height:100%;object-fit:cover;display:block}

    /* Feed */
    .feed{display:flex;flex-direction:column;gap:12px}
    .post{background:linear-gradient(180deg,rgba(255,255,255,.01),rgba(255,255,255,.005));padding:12px;border-radius:12px;overflow:hidden;transition:opacity .3s,transform .3s}
    .post.removing{opacity:0;transform:translateY(-8px) scale(.98);height:0;padding:0;margin:0}
    .post .meta{display:flex;gap:10px;align-items:center;margin-bottom:8px}
    .post img.photo{width:100%;height:auto;border-radius:8px;margin-top:8px;display:block}
    .caption{margin-top:8px;color:var(--muted);white-space:pre-wrap;word-break:break-word}

    .uploader{display:flex;flex-direction:column;gap:8px}
    .small{font-size:13px}

    .icon-btn{background:transparent;border:0;padding:6px;border-radius:8px;cursor:pointer}
    .eye{position:absolute;right:10px;top:10px;transform:translateY(2px);background:transparent;border:0;color:var(--muted);cursor:pointer}

    .spinner{width:20px;height:20px;border-radius:50%;border:3px solid rgba(255,255,255,.08);border-top-color:var(--accent);animation:spin 1s linear infinite;display:inline-block;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}

    .progress{font-size:13px;color:var(--muted)}
    .muted-alert{color:#ffb199;font-size:13px}

    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}

    .row{display:flex;gap:8px;align-items:center}

    /* responsive */
    @media (max-width:880px){main{grid-template-columns:1fr;} .container{padding:10px}}
  </style>
</head>
<body>
  <div class="container" id="app">
    <header>
      <div class="brand">
        <div class="logo">Rei</div>
        <div>
          <h1>Web Pribadi</h1>
          <p class="lead">Halloowwww selamat datang di web pribadi Reisya, silahkan masukkan username dan password anda!.</p>
        </div>
      </div>

      <div class="controls">
        <div class="muted small" id="storageHint">‚Äî</div>
        <button id="themeBtn" class="ghost">Toggle Theme</button>
      </div>
    </header>

    <main>
      <aside>
        <div class="card auth" id="authCard"></div>
        <div style="height:12px"></div>
        <div class="card">
          <h3 style="margin:0 0 8px 0">Tentang Web</h3>
          <p class="muted small">Ini web sederhana untuk praktikum ekskul IT di SMAN 37 Jakarta yang dibuat oleh Reisya Aulia dari kelas XII-4</p>
        </div>
      </aside>

      <section>
        <div class="card">
          <div id="composerArea"><div class="muted">Masuk untuk mengunggah foto.</div></div>
        </div>

        <div id="feed" class="feed" style="margin-top:12px"></div>
      </section>
    </main>

    <footer>Made in Reisya ‚ù§Ô∏è</footer>
  </div>

  <script>

    const STORAGE_USERS = 'myweb_users_v2'
    const STORAGE_SESSION = 'myweb_session_v2'
    const STORAGE_POSTS = 'myweb_posts_v2'
    const STORAGE_THEME = 'myweb_theme_v1'

    const MAX_FILE_BYTES = 2.5 * 1024 * 1024 

    const $ = (sel) => document.querySelector(sel)
    const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2,8)

    function loadJSON(key, fallback){ try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)) } catch(e){ return fallback } }
    function saveJSON(key,obj){
      try{
        localStorage.setItem(key, JSON.stringify(obj))
        return true
      }catch(e){
        if(isQuotaExceeded(e)) return false
        console.error(e); return false
      }
    }
    function isQuotaExceeded(e){
      return e && (e.code === 22 || e.code === 1014 || e.name === 'QuotaExceededError' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED')
    }

    function bytesPretty(b){
      if(b > 1024*1024) return (b/(1024*1024)).toFixed(2)+' MB'
      if(b > 1024) return (b/1024).toFixed(1)+' KB'
      return b + ' B'
    }

    function loadUsers(){ return loadJSON(STORAGE_USERS, []) }
    function saveUsers(u){ return saveJSON(STORAGE_USERS,u) }
    function loadPosts(){ return loadJSON(STORAGE_POSTS, []) }
    function savePosts(p){ return saveJSON(STORAGE_POSTS,p) }
    function getSession(){ return loadJSON(STORAGE_SESSION, null) }
    function setSession(u){ return saveJSON(STORAGE_SESSION, u) }
    function clearSession(){ localStorage.removeItem(STORAGE_SESSION) }

    function simpleHash(s){ let h=0; for(let i=0;i<s.length;i++){ h=(h<<5)-h + s.charCodeAt(i); h |= 0 } return h }

  
    function renderAuth(){
      const authCard = $('#authCard')
      const session = getSession()
      if(session){
      
        const users = loadUsers()
        const me = users.find(u=>u.id===session.id) || {}
        const avatarHtml = me.avatar ? `<img src="${me.avatar}" alt="avatar">` : session.username ? session.username[0].toUpperCase() : 'U'
        authCard.innerHTML = `
          <div class="profile">
            <div class="avatar">${typeof avatarHtml==='string' && avatarHtml.startsWith('data:') ? `<img src="${avatarHtml}">` : avatarHtml}</div>
            <div style="flex:1">
              <div style="font-weight:700">${session.username}</div>
              <div class="muted small">Terakhir login: ${new Date(session.last).toLocaleString()}</div>
            </div>
            <div style="display:flex;gap:8px;flex-direction:column">
              <button id="editProfileBtn" class="ghost small">Edit Profil</button>
              <button id="logoutBtn" class="ghost small">Logout</button>
            </div>
          </div>
          <div style="height:8px"></div>
          <div class="muted small">Note: Avatar & username disimpan di browser.</div>
        `
        $('#logoutBtn').onclick = ()=>{ clearSession(); renderAll() }
        $('#editProfileBtn').onclick = openEditProfile
      } else {
        authCard.innerHTML = `
          <h3>Masuk / Daftar</h3>
          <div class="field"><input id="inpUser" type="text" placeholder="Nama pengguna" autocomplete="username" /></div>
          <div class="field" style="position:relative">
            <input id="inpPass" type="password" placeholder="Kata sandi" autocomplete="current-password" />
            <button id="togglePass" class="eye" title="Lihat / sembunyikan sandi">‚úÖ</button>
          </div>
          <div style="display:flex;gap:8px">
            <button id="loginBtn">Masuk</button>
            <button id="regBtn" class="ghost">Daftar</button>
          </div>
          <div style="height:8px"></div>
          <div class="muted small">Akun & sandi hanya disimpan di browser (demo).</div>
        `
        $('#togglePass').onclick = ()=>{ const p = $('#inpPass'); p.type = p.type==='password' ? 'text' : 'password'; $('#togglePass').textContent = p.type==='password' ? '‚úÖ' : '‚ùå' }
        $('#togglePass').onclick = ()=>{ const p = $('#inpPass'); p.type = p.type==='password' ? 'text' : 'password'; $('#togglePass').textContent = p.type==='password' ? '‚úÖ' : '‚ùå' }
        $('#loginBtn').onclick = doLogin
        $('#regBtn').onclick = doRegister
      }
    }


    function doRegister(){
      const u = $('#inpUser').value.trim(); const p = $('#inpPass').value
      if(!u || !p){ alert('Isi nama pengguna dan kata sandi.'); return }
      let users = loadUsers()
      if(users.find(x=>x.username.toLowerCase()===u.toLowerCase())){ alert('Nama pengguna sudah dipakai.'); return }
      const newUser = {id:uid(), username:u, passHash:simpleHash(p), avatar:''}
      users.push(newUser)
      if(!saveUsers(users)){ alert('Penyimpanan gagal (localStorage penuh). Coba hapus beberapa posting dulu.'); return }
      alert('Terdaftar! Silakan masuk.')
      $('#inpPass').value = ''; $('#inpUser').value = ''
    }

    function doLogin(){
      const u = $('#inpUser').value.trim(); const p = $('#inpPass').value
      if(!u || !p){ alert('Isi nama pengguna dan kata sandi.'); return }
      let users = loadUsers()
      const found = users.find(x=>x.username.toLowerCase()===u.toLowerCase() && x.passHash===simpleHash(p))
      if(!found){ alert('Nama pengguna / kata sandi salah.'); return }
      const session = {id:found.id, username:found.username, last: Date.now()}
      if(!setSession(session)){ alert('Gagal menyimpan sesi.'); return }
      renderAll()
    }

 
    function openEditProfile(){
      const session = getSession(); if(!session) return
      const users = loadUsers(); const me = users.find(u=>u.id===session.id) || {}
      const authCard = $('#authCard')
      authCard.innerHTML = `
        <h3>Edit Profil</h3>
        <div style="display:flex;gap:10px;align-items:center">
          <div class="avatar" id="avatarPreview">${me.avatar ? `<img src="${me.avatar}">` : (me.username?me.username[0].toUpperCase():'U')}</div>
          <div style="flex:1">
            <input id="editName" type="text" value="${escapeHtml(me.username||'')}" placeholder="Nama pengguna"/>
            <div style="height:6px"></div>
            <input id="avatarInput" type="file" accept="image/*" />
          </div>
        </div>
        <div style="height:8px"></div>
        <div style="display:flex;gap:8px">
          <button id="saveProfileBtn">Simpan</button>
          <button id="cancelProfileBtn" class="ghost">Batal</button>
        </div>
      `
      $('#avatarInput').onchange = function(e){
        const f = e.target.files[0]; if(!f) return
        if(f.size > MAX_FILE_BYTES){ alert('Avatar terlalu besar. Maks '+bytesPretty(MAX_FILE_BYTES)); return }
        const r = new FileReader()
        r.onload = ev => { $('#avatarPreview').innerHTML = `<img src="${ev.target.result}">`; $('#avatarPreview').dataset.data = ev.target.result }
        r.readAsDataURL(f)
      }
      $('#cancelProfileBtn').onclick = renderAll
      $('#saveProfileBtn').onclick = function(){
        const users = loadUsers(); const idx = users.findIndex(u=>u.id===session.id)
        if(idx===-1) return alert('Pengguna tidak ditemukan.')
        const newName = $('#editName').value.trim(); if(!newName) return alert('Nama tidak boleh kosong.')
        users[idx].username = newName
        const avatarData = $('#avatarPreview').dataset.data
        if(avatarData) users[idx].avatar = avatarData
        if(!saveUsers(users)){ alert('Gagal menyimpan (localStorage penuh).'); return }
       
        const s = getSession(); s.username = newName; s.last = Date.now(); setSession(s)
        renderAll()
      }
    }

    function renderComposer(){
      const session = getSession()
      const area = document.getElementById('composerArea')
      if(!session){ area.innerHTML = '<div class="muted">Masuk untuk mengunggah foto.</div>'; return }

      area.innerHTML = `
        <div style="display:flex;align-items:center;gap:12px">
          <div class="avatar">${session.username[0].toUpperCase()}</div>
          <div style="flex:1">
            <div style="font-weight:700">${session.username}</div>
            <div class="muted small">Bagikan momenmu</div>
          </div>
        </div>
        <div style="height:10px"></div>
        <div class="uploader">
          <input id="fileInput" type="file" accept="image/*" />
          <input id="captionInput" type="text" placeholder="Tulis caption (opsional, min 3 karakter jika diisi)..." />
          <div class="row">
            <button id="postBtn">Unggah & Posting</button>
            <button id="clearBtn" class="ghost">Bersihkan</button>
            <div id="uploadState" style="margin-left:auto"></div>
          </div>
          <div class="muted small">Maks ukuran file: ${bytesPretty(MAX_FILE_BYTES)}. Posting disimpan di browser.</div>
        </div>`

      $('#postBtn').onclick = handlePost
      $('#clearBtn').onclick = ()=>{ $('#fileInput').value=''; $('#captionInput').value=''; $('#uploadState').innerHTML = '' }
    }

    async function handlePost(){
      const fileEl = $('#fileInput')
      const file = fileEl.files[0]
      const caption = $('#captionInput').value.trim()
      const session = getSession()
      if(!file){ alert('Pilih file gambar dulu.'); return }
      if(!session){ alert('Silakan masuk.'); return }
      if(caption && caption.length < 3){ alert('Jika diisi, caption minimal 3 karakter.'); return }
      if(file.size > MAX_FILE_BYTES){ alert('File terlalu besar. Maks: '+bytesPretty(MAX_FILE_BYTES)); return }

      const uploadState = $('#uploadState')
      // simple loading UI while reading file
      uploadState.innerHTML = '<span class="spinner"></span> <span class="progress">Mengunggah...</span>'
      $('#postBtn').disabled = true

      const reader = new FileReader()
      reader.onload = function(e){
        const dataURL = e.target.result
        let posts = loadPosts()
        posts.unshift({
          id: uid(),
          authorId: session.id,
          author: session.username,
          caption,
          img: dataURL,
          at: Date.now(),
          likes: 0
        })
      
        if(!savePosts(posts)){
          if(confirm('Penyimpanan penuh. Hapus postingan lama untuk memberi ruang?')){
          
            while(posts.length > 0){ posts.pop(); if(savePosts(posts)) break }
            if(!savePosts(posts)){ alert('Tetap gagal menyimpan. Tidak ada cukup ruang.'); $('#uploadState').innerHTML=''; $('#postBtn').disabled=false; return }
            alert('Posting lama dihapus. Silakan unggah lagi.')
            renderAll(); return
          } else {
            alert('Gagal menyimpan posting.'); $('#uploadState').innerHTML=''; $('#postBtn').disabled=false; return
          }
        }
        fileEl.value=''; $('#captionInput').value=''
        $('#postBtn').disabled = false
        uploadState.innerHTML = ''
        renderFeed()
      }
      reader.onerror = function(){ alert('Gagal membaca file.'); uploadState.innerHTML=''; $('#postBtn').disabled=false }
     
      setTimeout(()=>reader.readAsDataURL(file), 250)
    }

   
    function escapeHtml(s=""){ return s.replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) }

    
    function renderFeed(){
      const feed = $('#feed')
      const posts = loadPosts()
      if(!posts.length){ feed.innerHTML = '<div class="card muted">Belum ada postingan. Kamu bisa jadi yang pertama!</div>'; return }
      feed.innerHTML = ''
      for(const p of posts){
        const d = new Date(p.at)
        const el = document.createElement('div')
        el.className = 'post card'
        el.dataset.id = p.id
        el.innerHTML = `
          <div class="meta">
            <div class="avatar">${p.author[0].toUpperCase()}</div>
            <div style="flex:1">
              <div style="font-weight:700">${escapeHtml(p.author)}</div>
              <div class="muted small">${d.toLocaleString()}</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <button class="icon-btn small likeBtn" data-id="${p.id}">‚ù§Ô∏è <span class="likeCount">${p.likes||0}</span></button>
              <button class="icon-btn small delBtn" data-id="${p.id}">üóëÔ∏è</button>
            </div>
          </div>
          <div class="caption">${escapeHtml(p.caption || '')}</div>
          ${p.img?`<img class="photo" src="${p.img}" alt="photo" />`:''}`
        feed.appendChild(el)
      }
   
      feed.querySelectorAll('.likeBtn').forEach(btn=>{
        btn.addEventListener('click', (ev)=>{
          const id = btn.dataset.id
          toggleLike(id, btn)
        })
      })
     
      feed.querySelectorAll('.delBtn').forEach(btn=>{
        btn.addEventListener('click', ()=>removePost(btn.dataset.id))
      })
    }

    function toggleLike(id, btnEl){
      const posts = loadPosts(); const idx = posts.findIndex(p=>p.id===id); if(idx===-1) return
      posts[idx].likes = (posts[idx].likes||0) + 1
      if(!savePosts(posts)){ alert('Gagal menyimpan like (storage penuh).') }
      renderFeed()
    }

   
    function removePost(id){
      const session = getSession(); if(!session){ alert('Login untuk menghapus.'); return }
      let posts = loadPosts(); const idx = posts.findIndex(p=>p.id===id)
      if(idx===-1){ alert('Posting tidak ditemukan.'); return }
      const isOwner = posts[idx].authorId === session.id
      if(!isOwner){
        if(!confirm('Kamu bukan pemilik postingan. Tetap hapus?')) return
      } else {
        if(!confirm('Hapus postingan ini?')) return
      }
     
      const el = document.querySelector(`.post[data-id="${id}"]`)
      if(el){
        el.classList.add('removing')
        setTimeout(()=>{
          posts.splice(idx,1); savePosts(posts); renderFeed()
        }, 300)
      } else {
        posts.splice(idx,1); savePosts(posts); renderFeed()
      }
    }

 
    function applyTheme(t){
      document.documentElement.setAttribute('data-theme', t)
      localStorage.setItem(STORAGE_THEME, t)
    }
    function initTheme(){
      const t = localStorage.getItem(STORAGE_THEME) || 'dark'
      applyTheme(t)
      $('#themeBtn').onclick = ()=> applyTheme(document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark')
    }

    function updateStorageHint(){
     
      let total = 0
      for(let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i); try{ total += (localStorage.getItem(k)||'').length }catch(e){}
      }
      // convert chars to bytes roughly (UTF-16 -> 2 bytes per char)
      const bytes = total * 2
      $('#storageHint').textContent = `Storage ~ ${bytesPretty(bytes)} used`
    }

 
    function renderAll(){ renderAuth(); renderComposer(); renderFeed(); updateStorageHint() }

  
    (function init(){
      initTheme()
      if(!loadPosts().length){
        savePosts([{id:uid(), authorId:'sys', author:'System', caption:'Halo! Ini contoh feed. Upload fotomu supaya tampil di sini.', img:'', at: Date.now(), likes:0}])
      }
      if(!loadUsers().length){
        const demo = {id:'sys', username:'System', passHash:0, avatar:''}
        saveUsers([demo])
      }
      renderAll()
    
      setInterval(updateStorageHint, 2000)
    })()

    function escapeHtml(s=""){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) }
  </script>
</body>
</html>